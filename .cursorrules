# IVM-Lite Project Rules for Cursor AI

## í”„ë¡œì íŠ¸ ê°œìš”
IVM-LiteëŠ” Kotlin + Ktor ê¸°ë°˜ì˜ ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
RawData â†’ Slice â†’ View â†’ Sink íë¦„ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

## ì–¸ì–´ ì„¤ì •
- ì‘ë‹µì€ í•­ìƒ í•œêµ­ì–´ë¡œ í•©ë‹ˆë‹¤.
- ì½”ë“œ ì£¼ì„ë„ í•œêµ­ì–´ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

---

## ë¹Œë“œ & ì‹¤í–‰ ëª…ë ¹ì–´

> ğŸ’¡ **Tip**: `just` ëª…ë ¹ì–´ ëŸ¬ë„ˆ ì‚¬ìš© ê¶Œì¥ (`brew install just`)
> 
> ```bash
> just admin-dev      # Admin Backend ê°œë°œ ëª¨ë“œ (Hot Reload)
> just admin-ui-dev   # Admin Frontend ê°œë°œ ëª¨ë“œ
> just dev            # ì „ì²´ ê°œë°œ í™˜ê²½ ê°€ì´ë“œ
> just --list         # ëª¨ë“  ëª…ë ¹ì–´ ë³´ê¸°
> ```

### ë¹ ë¥¸ ë¹Œë“œ (í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ)
```bash
just build           # Just ì‚¬ìš©
# ë˜ëŠ”
./gradlew fastBuild
```

### Admin ì•± ì‹¤í–‰ (í¬íŠ¸ 8081)
```bash
# Just ì‚¬ìš© (ê¶Œì¥)
just admin-fast      # ë¹ ë¥¸ ë¹Œë“œ í›„ ì‹¤í–‰
just admin           # ê°œë°œ ëª¨ë“œ
just admin-dev       # Hot Reload ëª¨ë“œ

# ë˜ëŠ” Gradle ì§ì ‘ ì‚¬ìš©
./gradlew fastAdmin
./gradlew runAdminDev
./gradlew --no-configuration-cache --continuous runAdminDev
```

### Runtime API ì‹¤í–‰ (í¬íŠ¸ 8080)
```bash
just runtime         # Just ì‚¬ìš©
# ë˜ëŠ”
./gradlew run
```

### ì „ì²´ ë¹Œë“œ
```bash
./gradlew build
```

### í´ë¦° ë¹Œë“œ (ìºì‹œ ì •ë¦¬)
```bash
./gradlew clean build --no-build-cache
```

---

## í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´

### ê¸°ë³¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```bash
./gradlew test
```

### ë¹ ë¥¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ë³‘ë ¬ ì‹¤í–‰)
```bash
./gradlew unitTest
```

### í†µí•© í…ŒìŠ¤íŠ¸ (Docker í•„ìš”)
```bash
./gradlew integrationTest
```

### íŠ¹ì • íŒ¨í‚¤ì§€ í…ŒìŠ¤íŠ¸
```bash
./gradlew testPackage -Dpkg=slices
./gradlew testPackage -Dpkg=contracts
./gradlew testPackage -Dpkg=orchestration
```

### ì „ì²´ ê²€ì‚¬ (í…ŒìŠ¤íŠ¸ + ë¦°íŠ¸)
```bash
./gradlew checkAll
```

### ë¦°íŠ¸ë§Œ ì‹¤í–‰
```bash
./gradlew lint
./gradlew detekt
```

---

## Frontend (Admin UI)

### ê°œë°œ ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 3000, Hot Reload ìë™ ì§€ì›)
```bash
cd admin-ui && npm run dev
```

**ì ‘ì† ì£¼ì†Œ**:
- ê°œë°œ ì„œë²„: http://localhost:3000 (Vite HMR ìë™ ì§€ì›)
- í”„ë¡œë•ì…˜ ë¹Œë“œ: http://localhost:8081/admin (Backendì— ë¹Œë“œëœ ì •ì  íŒŒì¼ ì„œë¹™)

### ë¹Œë“œ
```bash
cd admin-ui && npm run build
```

### ë¦°íŠ¸
```bash
cd admin-ui && npm run lint
```

### íƒ€ì… ì²´í¬
```bash
cd admin-ui && npm run typecheck
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/kotlin/com/oliveyoung/ivmlite/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ admin/          # Admin API (í¬íŠ¸ 8081)
â”‚   â”œâ”€â”€ runtimeapi/     # Runtime API (í¬íŠ¸ 8080)
â”‚   â””â”€â”€ opscli/         # CLI ë„êµ¬
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ contracts/      # Contract ë„ë©”ì¸
â”‚   â”œâ”€â”€ rawdata/        # RawData ë„ë©”ì¸
â”‚   â”œâ”€â”€ slices/         # Slice ë„ë©”ì¸
â”‚   â”œâ”€â”€ views/          # View ë„ë©”ì¸
â”‚   â”œâ”€â”€ sinks/          # Sink ë„ë©”ì¸
â”‚   â”œâ”€â”€ orchestration/  # Outbox & Worker
â”‚   â””â”€â”€ ...
â””â”€â”€ shared/             # ê³µí†µ ìœ í‹¸ë¦¬í‹°

admin-ui/src/
â”œâ”€â”€ app/                # ì•± ì„¤ì •, ë¼ìš°íŒ…
â”œâ”€â”€ features/           # ê¸°ëŠ¥ë³„ ëª¨ë“ˆ
â”œâ”€â”€ shared/             # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â””â”€â”€ widgets/            # ë ˆì´ì•„ì›ƒ ìœ„ì ¯
```

---

## ì•„í‚¤í…ì²˜ ì›ì¹™

1. Hexagonal Architecture: Port/Adapter íŒ¨í„´
2. Contract is Law: YAML ê³„ì•½ì´ SSOT
3. Domain-Sliced Design: ë„ë©”ì¸ë³„ ëª¨ë“ˆ ë¶„ë¦¬
4. FSD (Feature-Sliced Design): í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

---

## í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì¤‘ìš”!)

**.env íŒŒì¼ì— DB ì ‘ì† ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤. jOOQ ì½”ë“œ ìƒì„±, í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ë°˜ë“œì‹œ ë¡œë“œí•˜ì„¸ìš”.**

```bash
# .env ë¡œë“œ í›„ Gradle ì‹¤í–‰
source .env && ./gradlew jooqCodegen
source .env && ./gradlew test

# ë˜ëŠ” exportë¡œ ì§ì ‘ ì„¤ì •
export DB_URL="jdbc:postgresql://..."
export DB_USER="postgres"
export DB_PASSWORD="..."
```

.env íŒŒì¼ ì£¼ìš” ë³€ìˆ˜:
- `DB_URL`: PostgreSQL JDBC URL
- `DB_USER`: DB ì‚¬ìš©ì
- `DB_PASSWORD`: DB ë¹„ë°€ë²ˆí˜¸
- `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`: DynamoDB ì ‘ê·¼ìš©

---

## ì£¼ì˜ì‚¬í•­

1. **í™˜ê²½ë³€ìˆ˜**: .env íŒŒì¼ì—ì„œ ë¡œë“œ (source .env)
2. Configuration Cache: í™œì„±í™”ë˜ì–´ ìˆìŒ. í™˜ê²½ë³€ìˆ˜ëŠ” System.getenv() ëŒ€ì‹  providers.environmentVariable() ì‚¬ìš© ê¶Œì¥
3. í†µí•© í…ŒìŠ¤íŠ¸: Dockerê°€ í•„ìš”í•¨ (integrationTest íƒœìŠ¤í¬)
4. jOOQ ì½”ë“œ: ./gradlew jooqCodegenìœ¼ë¡œ DBì—ì„œ ìƒì„± (DB ì—°ê²° í•„ìš”, .env ë¡œë“œ í•„ìˆ˜)
5. ê³„ì•½ íŒŒì¼: src/main/resources/contracts/v1/ ì— YAMLë¡œ ì •ì˜

---

## ìì£¼ ì‚¬ìš©í•˜ëŠ” ì›Œí¬í”Œë¡œìš°

### ê°œë°œ ì‹œì‘ (ì „ì²´ í™˜ê²½)
```bash
# Just ì‚¬ìš© (ê¶Œì¥)
just dev  # ì‹¤í–‰ ê°€ì´ë“œ í‘œì‹œ

# í„°ë¯¸ë„ 1: Backend (Hot Reload)
just admin-dev

# í„°ë¯¸ë„ 2: Frontend (Hot Reload)
just admin-ui-dev
```

**ì ‘ì† ì£¼ì†Œ**:
- Frontend ê°œë°œ ì„œë²„: http://localhost:3000 (Vite HMR ìë™ ì§€ì›)
- Backend API: http://localhost:8081/api
- í”„ë¡œë•ì…˜ ë¹Œë“œ: http://localhost:8081/admin

**ì°¸ê³ **: 
- Backend Hot Reload: íŒŒì¼ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì¬ë¹Œë“œ ë° ì¬ì‹œì‘ë©ë‹ˆë‹¤
- Frontend Hot Reload: Viteê°€ ìë™ìœ¼ë¡œ HMR(Hot Module Replacement) ì§€ì›
- í¬íŠ¸ ì¶©ëŒ ì‹œ: `just kill-ports` ë˜ëŠ” `lsof -ti:8081 | xargs kill -9`

### ì½”ë“œ ìˆ˜ì • í›„ í™•ì¸
```bash
./gradlew unitTest testPackage -Dpkg=ìˆ˜ì •í•œíŒ¨í‚¤ì§€ëª…
```

### PR ì „ ì²´í¬
```bash
./gradlew checkAll
cd admin-ui && npm run lint && npm run typecheck
```
