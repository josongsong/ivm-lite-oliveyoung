# ivm-lite Application Configuration
# RFC-IMPL-009: Hoplite 기반 (Env > YAML > defaults)

server:
  host: 0.0.0.0
  port: 8080

database:
  # Remote-only: .env 또는 환경 변수에서 로드
  url: jdbc:postgresql://ivm-lite.crcikgmci55c.ap-northeast-2.rds.amazonaws.com:5432/ivmlite?sslmode=require
  user: postgres
  password: "Dhfflqmdud9("
  maxPoolSize: 10
  minIdle: 2

dynamodb:
  # Remote-only: 기본값은 AWS 엔드포인트 사용 (override는 opt-in)
  endpoint: ${DYNAMODB_ENDPOINT:-}
  region: ${AWS_REGION:-ap-northeast-2}
  # Remote-only: 환경 변수 우선, 없으면 .env 기본값 사용
  tableName: ${DYNAMODB_TABLE:-ivm-lite-schema-registry}
  # AWS 자격 증명 (환경 변수 우선, 없으면 여기서 사용)
  accessKeyId: ${AWS_ACCESS_KEY_ID:-AKIAQ3EGTFD6OOJMNI6W}
  secretAccessKey: ${AWS_SECRET_ACCESS_KEY:-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}

kafka:
  bootstrapServers: ${KAFKA_BOOTSTRAP_SERVERS:-localhost:9094}
  consumerGroup: ivm-lite
  topicPrefix: ${KAFKA_TOPIC_PREFIX:-ivm}  # 토픽명: {topicPrefix}.events.{aggregatetype}

contracts:
  resourcePath: /contracts/v1

observability:
  metricsEnabled: true
  tracingEnabled: true
  otlpEndpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4317}
  # AWS X-Ray 사용 여부 (true면 X-Ray Daemon 직접 전송, false면 OTLP Collector 사용)
  # 권장: false (OTLP Collector → awsxray exporter 방식)
  useXRay: ${USE_XRAY:-false}
  # AWS Region (X-Ray 사용 시 필요, 기본값은 dynamodb.region 사용)
  awsRegion: ${AWS_REGION:-ap-northeast-2}

worker:
  enabled: ${WORKER_ENABLED:-true}
  pollIntervalMs: ${WORKER_POLL_INTERVAL_MS:-100}
  idlePollIntervalMs: ${WORKER_IDLE_POLL_INTERVAL_MS:-1000}
  batchSize: ${WORKER_BATCH_SIZE:-100}
  maxBackoffMs: ${WORKER_MAX_BACKOFF_MS:-30000}
  backoffMultiplier: ${WORKER_BACKOFF_MULTIPLIER:-2.0}
  jitterFactor: ${WORKER_JITTER_FACTOR:-0.1}
  shutdownTimeoutMs: ${WORKER_SHUTDOWN_TIMEOUT_MS:-10000}
  # 처리할 토픽 (null이면 모든 토픽)
  # 예: topics: ["ivm.events.raw_data", "ivm.events.slice"]
  # topics: ${WORKER_TOPICS:-}
