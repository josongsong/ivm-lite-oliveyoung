# ivm-lite Semgrep config
# Registry rulesets: p/default, p/kotlin, p/security-audit (see scripts/semgrep.sh)
# Custom rules / overrides below.

rules:
  - id: no-print-stack-trace
    message: Avoid printStackTrace(); use proper logging (e.g. logger.error).
    severity: WARNING
    languages: [kotlin, java]
    pattern: $X.printStackTrace(...)

  - id: no-runtime-exec
    message: Avoid Runtime.exec/ProcessBuilder for shell commands; use validated APIs to prevent command injection.
    severity: WARNING
    languages: [kotlin, java]
    pattern-either:
      - pattern: Runtime.getRuntime().exec(...)
      - pattern: ProcessBuilder(...)

  # ============================================
  # ì•„í‚¤í…ì²˜ ì œì•½ ê·œì¹™ (ë ˆì´ì–´ ì˜ì¡´ì„± ë°©í–¥)
  # ============================================
  # pkg (core) â†’ sdk ì—­ì°¸ì¡° ê¸ˆì§€
  - id: pkg-must-not-import-sdk
    message: |
      ğŸš« ì•„í‚¤í…ì²˜ ìœ„ë°˜: pkg(ì½”ì–´)ëŠ” sdkë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      ì˜ì¡´ì„± ë°©í–¥: sdk â†’ pkg â†’ shared (ë‹¨ë°©í–¥)
      
      í•´ê²° ë°©ë²•:
      - ê³µí†µ ëª¨ë¸ì€ shared.domainìœ¼ë¡œ ì´ë™
      - sdk.model.X â†’ shared.domain.X
    severity: ERROR
    languages: [kotlin]
    pattern: import com.oliveyoung.ivmlite.sdk.$...
    paths:
      include:
        - "**/pkg/**/*.kt"

  # pkg (core) â†’ apps ì—­ì°¸ì¡° ê¸ˆì§€
  - id: pkg-must-not-import-apps
    message: |
      ğŸš« ì•„í‚¤í…ì²˜ ìœ„ë°˜: pkg(ì½”ì–´)ëŠ” appsë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      ì˜ì¡´ì„± ë°©í–¥: apps â†’ pkg â†’ shared (ë‹¨ë°©í–¥)
    severity: ERROR
    languages: [kotlin]
    pattern: import com.oliveyoung.ivmlite.apps.$...
    paths:
      include:
        - "**/pkg/**/*.kt"

  # sdk â†’ apps ì—­ì°¸ì¡° ê¸ˆì§€
  - id: sdk-must-not-import-apps
    message: |
      ğŸš« ì•„í‚¤í…ì²˜ ìœ„ë°˜: sdkëŠ” appsë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      ì˜ì¡´ì„± ë°©í–¥: apps â†’ sdk â†’ pkg â†’ shared (ë‹¨ë°©í–¥)
    severity: ERROR
    languages: [kotlin]
    pattern: import com.oliveyoung.ivmlite.apps.$...
    paths:
      include:
        - "**/sdk/**/*.kt"

  # sharedëŠ” pkg, sdk, apps ëª¨ë‘ ì°¸ì¡° ê¸ˆì§€ (ìµœí•˜ìœ„ ë ˆì´ì–´)
  - id: shared-must-be-independent
    message: |
      ğŸš« ì•„í‚¤í…ì²˜ ìœ„ë°˜: sharedëŠ” ë‹¤ë¥¸ ë ˆì´ì–´ë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      sharedëŠ” ìµœí•˜ìœ„ ë ˆì´ì–´ë¡œ ë…ë¦½ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
    severity: ERROR
    languages: [kotlin]
    pattern-either:
      - pattern: import com.oliveyoung.ivmlite.pkg.$...
      - pattern: import com.oliveyoung.ivmlite.sdk.$...
      - pattern: import com.oliveyoung.ivmlite.apps.$...
    paths:
      include:
        - "**/shared/**/*.kt"
