RFC-V4-008 â€” Deploy Orchestration Law & Fluent DX

Deploy Orchestration Law & Fluent DX (Compile / Ship / Cutover Axes + Outbox Governance)

Status: Final â†’ **ADRë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë¨** ([ADR-0008](../adr/0008-deploy-orchestration-fluent-dx.md))
Created: 2026-01-25
Scope: ivm-engine(deploy), slicing, sink, shared/outbox, shared/contract-registry, sdk(codegen)
Depends on: RFC-V4-001, RFC-V4-002, RFC-V4-003, RFC-V4-004, RFC-V4-007
Audience: Platform / Architecture / SDK Developers / Contract Authors
Non-Goals: CRUD/Authoring, ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°, ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë„ì…, ìš´ì˜/ìš©ëŸ‰ íŠœë‹

> **ì°¸ê³ **: ì´ RFCëŠ” ADR-0008ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤. í•µì‹¬ ê²°ì •ì‚¬í•­ì€ ADRì„ ì°¸ê³ í•˜ì„¸ìš”.
> ìƒì„¸í•œ ì„¤ê³„ ë‚´ìš©ì€ ì´ RFC ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

0. Executive Summary

ë³¸ RFCëŠ” IVM ì—”ì§„ì—ì„œ Deploy ì‹¤í–‰ ë°©ì‹, Outbox ì‚¬ìš© ì‹œì /ë°©ì‹, ìƒíƒœ ë¨¸ì‹ , Swap ë²•ì¹™, Fluent SDK DXë¥¼ í•˜ë‚˜ì˜ SSOTë¡œ ê³ ì •í•œë‹¤.

**í•µì‹¬ ê²°ë¡ **:
- IVMì€ ê³„ì•½ëœ Raw ë°ì´í„°ë§Œ ì…ë ¥ìœ¼ë¡œ ë°›ìŒ
- ë…¸ì¶œì€ ì˜¤ì§ deployë¥¼ í†µí•´ì„œë§Œ ë°œìƒ
- Deploy ì‹¤í–‰ì€ Compile / Ship / Cutover 3ì¶• ì„ íƒìœ¼ë¡œ í‘œí˜„ë¨
- slicingì„ ë¹„ë™ê¸°í™”í•˜ë©´ shipì€ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ì‡„ outboxê°€ ë¨
- OutboxëŠ” "ì¬ì‹œë„"ê°€ ì•„ë‹ˆë¼ ì‹¤í–‰ ë¶„ë¦¬Â·í™•ì¥Â·ê´€ì¸¡ì„ ìœ„í•œ SSOT
- SDKëŠ” contract-registry ê¸°ë°˜ codegenìœ¼ë¡œ IDEê°€ ë¬¸ì„œê°€ ë˜ë„ë¡ ì„¤ê³„ë¨

**RFC-001~007ê³¼ì˜ ì¼ê´€ì„±**:
- RFC-001: slicing, ChangeSet, Inverted Index ê°œë… (RFC-001: 7-3, 9-1)
- RFC-002: ê²°ì •ì„±, ë©±ë“±ì„±, ì—ëŸ¬ ì²˜ë¦¬ (RFC-002: 1-3, 1-4)
- RFC-003: Contract Registry ê¸°ë°˜ ê´€ë¦¬ (RFC-003: 2-1)
- RFC-004: Replay/Backfill ì—°ê³„ (RFC-004: 13)
- RFC-007: Sink Orchestration, Outbox ì‚¬ìš© (RFC-007: 3-2, 3-5)

1. ê°œë… ì •ì˜ (ì •í™•í•œ ì„  ê¸‹ê¸°)

**1-1. Compile**

**ì •ì˜**: snapshot ìƒì„±, diff/impact ê³„ì‚°, slicing ìˆ˜í–‰í•˜ëŠ” ê²°ì •ì  ë‚´ë¶€ ê³„ì‚° ë‹¨ê³„

**RFC-001ê³¼ì˜ ì—°ê³„**:
- Canonical Snapshot ìƒì„± (RFC-001: 7-1)
- ChangeSet ê³„ì‚° (RFC-001: 9-1-1)
- Slice ë¹Œë“œ (RFC-001: 10-1)
- Inverted Index ì—…ë°ì´íŠ¸ (RFC-001: 17-6-1)

**ê²°ì •ì„± ë³´ì¥ (RFC-002: 1-3)**:
- ë™ì¼ ì…ë ¥ â†’ ë™ì¼ ì¶œë ¥ ë³´ì¥
- ì‹œê°„/ëœë¤ ê¸ˆì§€
- ê²°ì •ì  í•´ì‹± (RFC-002: 2-1)

**1-2. Ship**

**ì •ì˜**: slicing ì‚°ì¶œë¬¼ì„ ì™¸ë¶€ ì‹œìŠ¤í…œìœ¼ë¡œ ì „íŒŒí•˜ëŠ” side-effect ë‹¨ê³„

**RFC-007ê³¼ì˜ ì—°ê³„**:
- Sink Orchestration ì‹¤í–‰ (RFC-007: 5-1)
- SinkPluginì´ Slice/Viewë¥¼ ì½ì–´ì„œ ì™¸ë¶€ ì‹œìŠ¤í…œì— ì „ë‹¬ (RFC-007: 4-1)
- OpenSearch / Reco / ê¸°íƒ€ sink (RFC-007: 6, 7)

**ë©±ë“±ì„± ë³´ì¥ (RFC-002: 1-4)**:
- doc_id ê¸°ë°˜ idempotent (RFC-007: 6-3)
- ë™ì¼ taskId ì¬ì‹¤í–‰ ì‹œ ë™ì¼ ê²°ê³¼ (RFC-007: 2-3)

**1-3. Cutover (Swap)**

**ì •ì˜**: storefrontê°€ ì½ëŠ” active pointerë¥¼ ì‹ ê·œ ì‚°ì¶œë¬¼ë¡œ ì „í™˜í•˜ëŠ” ë‹¨ê³„ (ë°ì´í„° ì´ë™ ì—†ìŒ, pointer swap)

**RFC-001ê³¼ì˜ ì—°ê³„**:
- active_version í¬ì¸í„° ì—…ë°ì´íŠ¸ (RFC-001: 19)
- active_versionì€ ì™¸ë¶€ í¬ì¸í„°ì´ë©° SSOT ì•„ë‹˜ (RFC-001: 19)

**RFC-004ì™€ì˜ ì—°ê³„**:
- Replay ì‹œ active_version ì—…ë°ì´íŠ¸ (RFC-004: 13)

2. ì‹¤í–‰ ì¶• (SSOT)

DeployëŠ” ë‹¤ìŒ 3ì¶• ì¡°í•©ìœ¼ë¡œ ì •ì˜ë¨.

**2-1. Compile ì¶•**

**compile.sync()**: ìš”ì²­ íë¦„ì—ì„œ slicingê¹Œì§€ ë™ê¸° ìˆ˜í–‰

**íŠ¹ì§•**:
- API ìš”ì²­ â†’ RawData ì €ì¥ â†’ Snapshot ìƒì„± â†’ ChangeSet ê³„ì‚° â†’ Slice ë¹Œë“œ â†’ ì™„ë£Œ
- ë™ê¸° ì‘ë‹µìœ¼ë¡œ ê²°ê³¼ ë°˜í™˜
- ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì—ëŸ¬ ë°˜í™˜

**compile.async()**: slicingì„ outbox jobìœ¼ë¡œ ë¶„ë¦¬

**íŠ¹ì§•**:
- API ìš”ì²­ â†’ RawData ì €ì¥ â†’ COMPILE_TASK outbox ê¸°ë¡ â†’ ì¦‰ì‹œ ì‘ë‹µ
- workerê°€ outbox consume â†’ slicing ìˆ˜í–‰
- ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ outbox ì‚¬ìš© (RFC-007: 7-1)

**2-2. Ship ì¶•**

**ship.sync {}**: ì™¸ë¶€ sinkê¹Œì§€ ìš”ì²­ íë¦„ì—ì„œ ë™ê¸° ìˆ˜í–‰

**íŠ¹ì§•**:
- Compile ì™„ë£Œ í›„ â†’ SinkOrchestrator ì‹¤í–‰ â†’ SinkPluginì´ ì™¸ë¶€ ì‹œìŠ¤í…œì— ì „ë‹¬ â†’ ì™„ë£Œ
- ë™ê¸° ì‘ë‹µìœ¼ë¡œ ê²°ê³¼ ë°˜í™˜
- ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì—ëŸ¬ ë°˜í™˜

**ship.async {}**: sinkë¥¼ outboxë¡œ ì „íŒŒ

**íŠ¹ì§•**:
- Compile ì™„ë£Œ í›„ â†’ SHIP_TASK outbox ê¸°ë¡ â†’ ì¦‰ì‹œ ì‘ë‹µ
- workerê°€ outbox consume â†’ SinkOrchestrator ì‹¤í–‰
- ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ outbox ì‚¬ìš© (RFC-007: 7-1)

**2-3. Cutover ì¶•**

**cutover.ready()** (ê¸°ë³¸): READY ë„ë‹¬ ì¦‰ì‹œ swap

**íŠ¹ì§•**:
- Compile ì™„ë£Œ ì‹œì ì— active_version ì¦‰ì‹œ ì—…ë°ì´íŠ¸
- storefrontëŠ” ì¦‰ì‹œ ìµœì‹  slice ì‚¬ìš©
- shipì€ ì´í›„ ì§„í–‰ (ë¹„ë™ê¸°)

**cutover.done()** (ì˜µì…˜): shipê¹Œì§€ ì „ë¶€ ì„±ê³µ í›„ swap

**íŠ¹ì§•**:
- Compile + Ship ëª¨ë‘ ì™„ë£Œ í›„ active_version ì—…ë°ì´íŠ¸
- storefrontëŠ” ship ì™„ë£Œ í›„ì—ë§Œ ìµœì‹  slice ì‚¬ìš©

3. í—ˆìš© ì¡°í•© ê·œì¹™ (ê°•ì œ ë¶ˆë³€ì‹, P0)

| Compile | Ship | í—ˆìš© | ì´ìœ  |
|---------|------|------|------|
| sync | sync | â­• ê°€ëŠ¥ | ì‚°ì¶œë¬¼ ì¡´ì¬ |
| sync | async | â­• ê°€ëŠ¥ | ì‚°ì¶œë¬¼ ì¡´ì¬ |
| async | async | â­• ê°€ëŠ¥ | worker ì²´ì¸ |
| async | sync | âŒ ë¶ˆê°€ | ì‚°ì¶œë¬¼ ì¤€ë¹„ ì „ ë™ê¸° ship ë¶ˆê°€ |

**SDK ë ˆë²¨ì—ì„œ compile.async + ship.syncëŠ” íƒ€ì…ìœ¼ë¡œ ì°¨ë‹¨í•¨.**

**RFC-007ê³¼ì˜ ì¼ê´€ì„±**:
- SinkëŠ” í•­ìƒ íŠ¸ë¦¬ê±° ê¸°ë°˜ (RFC-007: 2-1)
- Slice/ViewëŠ” Portë¥¼ í†µí•´ ì½ê¸° (RFC-007: 4-2)
- OutboxëŠ” ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ ì‚¬ìš© (RFC-007: 7-1)

4. Deploy ìƒíƒœ ë¨¸ì‹  (SSOT)

**4-1. States**

**QUEUED**: compile/ship jobì´ outboxì— ê¸°ë¡ë¨

**RUNNING**: compile ìˆ˜í–‰ ì¤‘

**READY**: slicing ì™„ë£Œ, swap ê°€ëŠ¥

**SINKING**: ship ìˆ˜í–‰ ì¤‘

**DONE**: deploy ì™„ë£Œ

**FAILED**: ì‹¤íŒ¨(ì¬ì‹œë„ ê°€ëŠ¥)

**4-2. ê¸°ë³¸ íë¦„ (cutover.ready)**

```
QUEUED â†’ RUNNING â†’ READY â†’ SINKING â†’ DONE
                    â†˜ FAILED
```

**ìƒíƒœ ì „ì´ ê·œì¹™**:
- QUEUED â†’ RUNNING: workerê°€ outbox consume ì‹œì‘
- RUNNING â†’ READY: slicing ì™„ë£Œ
- READY â†’ SINKING: ship ì‹œì‘ (cutover.ready() ì‹œ READYì—ì„œ ì¦‰ì‹œ swap)
- SINKING â†’ DONE: ship ì™„ë£Œ
- RUNNING â†’ FAILED: compile ì‹¤íŒ¨
- SINKING â†’ FAILED: ship ì‹¤íŒ¨

**4-3. ì¬ì‹œë„ ê·œì¹™ (RFC-002 ì¤€ìˆ˜)**

**Soft Failure (TransientError)**: Exponential backoff ì¬ì‹œë„ (RFC-002: 3-2)

**Hard Failure (InvariantViolation)**: ì¦‰ì‹œ ì¤‘ë‹¨, ì¬ì‹œë„ ê¸ˆì§€ (RFC-002: 3-1)

**ConcurrencyConflict**: Single-flight ì¶©ëŒ ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„ (RFC-002: 3-4)

5. Cutover (Swap) ë²•ì¹™

**5-1. READY Cutover (Default)**

**ì •ì˜**: READY ë„ë‹¬ ì¦‰ì‹œ swap

**ë™ì‘**:
- storefrontëŠ” ì¦‰ì‹œ ìµœì‹  slice ì‚¬ìš©
- shipì€ ì´í›„ ì§„í–‰ (ë¹„ë™ê¸°)

**DONE ì •ì˜**:
- swap ì™„ë£Œ + ship job queued(ìˆë‹¤ë©´)

**RFC-001ê³¼ì˜ ì—°ê³„**:
- active_version í¬ì¸í„° ì—…ë°ì´íŠ¸ (RFC-001: 19)
- active_versionì€ ì™¸ë¶€ í¬ì¸í„°ì´ë©° SSOT ì•„ë‹˜ (RFC-001: 19)

**5-2. DONE Cutover (Optional)**

**ì •ì˜**: shipê¹Œì§€ ì „ë¶€ ì„±ê³µ í›„ swap

**ë™ì‘**:
- Compile + Ship ëª¨ë‘ ì™„ë£Œ í›„ active_version ì—…ë°ì´íŠ¸
- storefrontëŠ” ship ì™„ë£Œ í›„ì—ë§Œ ìµœì‹  slice ì‚¬ìš©

**DONE ì •ì˜**:
- ship ì„±ê³µ + swap ì™„ë£Œ

**ì‚¬ìš© ì‚¬ë¡€**:
- ì™¸ë¶€ ì‹œìŠ¤í…œ(Sink)ê³¼ì˜ ì •í•©ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°
- Ship ì‹¤íŒ¨ ì‹œ storefrontì— ë…¸ì¶œí•˜ì§€ ì•Šì•„ì•¼ í•˜ëŠ” ê²½ìš°

6. Outbox ì‚¬ìš© ì •ì±… (ì •í™•í•œ ì‹œì , P0)

**6-1. Outboxê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°**

**compile.async()** â†’ COMPILE_TASK outbox ê¸°ë¡

**ship.async()** â†’ SHIP_TASK outbox ê¸°ë¡

**compile async ì™„ë£Œ í›„ shipì´ ìˆë‹¤ë©´ ì—°ì‡„ outbox ìƒì„±**

**RFC-007ê³¼ì˜ ì¼ê´€ì„±**:
- OutboxëŠ” ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ ì‚¬ìš© (RFC-007: 7-1)
- Outbox ì´ë²¤íŠ¸ëŠ” ì°¸ì¡°ë§Œ ì €ì¥ (RFC-007: 3-5)
- ì‹¤ë°ì´í„°ëŠ” outboxì— ì €ì¥í•˜ì§€ ì•ŠìŒ (RFC-007: 3-5)

**6-2. Outboxë¥¼ ì“°ì§€ ì•ŠëŠ” ê²½ìš°**

**compile.sync()** ë‹¨ê³„

**ship.sync()** ë‹¨ê³„

**ğŸ‘‰ OutboxëŠ” ë¹„ë™ê¸° ê²½ê³„ê°€ ìƒê¸°ëŠ” ìˆœê°„ì—ë§Œ ì‚¬ìš©ë¨.**

**RFC-007ê³¼ì˜ ì¼ê´€ì„±**:
- Sync-first (v0)ì—ì„œëŠ” outbox ì‚¬ìš© ì•ˆ í•¨ (RFC-007: 3-1)
- Outbox ê¸°ë°˜ Async (v1+)ì—ì„œë§Œ outbox ì‚¬ìš© (RFC-007: 3-2)

7. Outbox Task ëª¨ë¸

**7-1. Task ì¢…ë¥˜**

**COMPILE_TASK**: slicing ìˆ˜í–‰ ì‘ì—…

**SHIP_TASK**: sink ì „íŒŒ ì‘ì—…

**7-2. ê³µí†µ í•„ë“œ**

```kotlin
data class OutboxTask(
    val taskId: String,  // UUID (ë©±ë“±ì„± í‚¤)
    val type: TaskType,  // COMPILE_TASK | SHIP_TASK
    val status: TaskStatus,  // PENDING | RUNNING | SUCCESS | FAILED | DEAD
    val leaseOwner: String?,  // worker ì‹ë³„ì
    val leaseUntil: Instant?,  // lease ë§Œë£Œ ì‹œê°
    val attempt: Int,  // ì¬ì‹œë„ íšŸìˆ˜
    val payload: TaskPayload,  // ref-only (ì‹¤ë°ì´í„° ê¸ˆì§€)
    val createdAt: Instant
)
```

**7-3. ë¶ˆë³€ì‹ (P0, í•„ìˆ˜)**

**lease ê¸°ë°˜ ë‹¨ì¼ ì‹¤í–‰ì**: FOR UPDATE SKIP LOCKED (RFC-002: 3-4)

**taskId ê¸°ë°˜ ë©±ë“±**: ë™ì¼ taskId ì¬ì‹¤í–‰ ì‹œ ë™ì¼ ê²°ê³¼ (RFC-002: 1-4)

**payloadì— ì‹¤ë°ì´í„° ê¸ˆì§€**: refë§Œ í—ˆìš© (RFC-007: 3-5)

**RFC-007ê³¼ì˜ ì¼ê´€ì„±**:
- SinkTriggerEventëŠ” ì°¸ì¡°ë§Œ ì €ì¥ (RFC-007: 3-5)
- taskIdëŠ” ë©±ë“±ì„± í‚¤ë¡œ ê³ ì • (RFC-007: 3-5)

8. Outbox ì‹¤í–‰ ëª¨ë¸ (v0 ê¸°ì¤€)

**8-1. ì €ì¥ì†Œ**

**PostgreSQL ê¶Œì¥**: ACID ë³´ì¥, íŠ¸ëœì­ì…˜ ì§€ì›

**polling + FOR UPDATE SKIP LOCKED**: ë™ì‹œì„± ì œì–´ (RFC-002: 3-4)

**8-2. Worker ë£¨í”„**

1. PENDING task ì¡°íšŒ (FOR UPDATE SKIP LOCKED)
2. lease íšë“ (leaseOwner, leaseUntil ì„¤ì •)
3. RUNNING ì „ì´
4. ì‹¤í–‰ (compile ë˜ëŠ” ship)
5. SUCCESS / FAILED ì „ì´
6. ì‹¤íŒ¨ ì‹œ backoff í›„ ì¬ì‹œë„ (RFC-002: 3-2)
7. attempt ì´ˆê³¼ ì‹œ DEAD

**RFC-002ì™€ì˜ ì¼ê´€ì„±**:
- Optimistic locking with exponential backoff (RFC-002: 3-4)
- Single-Flight for unique (tenant, entityKey, version, ruleSet) (RFC-002: 3-4)

9. Fluent SDK DX (Contract Codegen)

**9-1. Raw ì…ë ¥ì€ codegen DSLë§Œ í—ˆìš©**

```kotlin
Ivm.client()
  .ingest()
  .product {
    sku("ABC-123")
    name("Moisture Cream")
    price(19000)
    currency("KRW")
  }
```

**product {}** ëŠ” Contract Registry ê¸°ë°˜ codegen ì‚°ë¬¼

**ë¬¸ìì—´ ì—”í‹°í‹°/ìŠ¤í‚¤ë§ˆ ê¸ˆì§€**: íƒ€ì… ì•ˆì „ì„± ë³´ì¥

**RFC-003ê³¼ì˜ ì¼ê´€ì„±**:
- Contract Registry ê¸°ë°˜ ê´€ë¦¬ (RFC-003: 2-1)
- Contract â†’ Codegen â†’ Simulate â†’ Deploy â†’ Replay (RFC-003: 2-17)

**9-2. Contract Registry ê¸°ë°˜ Codegen**

**ì½”ë“œ ìƒì„±**:
- Contract Registryì—ì„œ RuleSet ë¡œë“œ (RFC-003: 2-1)
- EntityTypeë³„ DSL ìƒì„±
- íƒ€ì… ì•ˆì „ì„± ë³´ì¥

**IDE ì§€ì›**:
- ìë™ì™„ì„±
- íƒ€ì… ì²´í¬
- ë¬¸ì„œí™”

10. Deploy DX â€” ê°€ì¥ ì§ê´€ì ì¸ í‘œí˜„

**10-1. ê¸°ë³¸ê°’ (ì •ì„)**

**compile sync + cutover ready + ship async**

```kotlin
Ivm.client()
  .ingest()
  .product { ... }
  .deploy {
    ship.async {
      opensearch()
      personalize()
    }
  }
```

**ë™ì‘**:
- Compile: ë™ê¸° ìˆ˜í–‰
- Cutover: READY ë„ë‹¬ ì¦‰ì‹œ swap
- Ship: ë¹„ë™ê¸° ìˆ˜í–‰ (outbox)

**10-2. ì „ë¶€ ì¦‰ì‹œ**

```kotlin
Ivm.client()
  .ingest()
  .product { ... }
  .deploy {
    compile.sync()
    ship.sync {
      opensearch()
      personalize()
    }
  }
```

**ë™ì‘**:
- Compile: ë™ê¸° ìˆ˜í–‰
- Ship: ë™ê¸° ìˆ˜í–‰
- Cutover: Ship ì™„ë£Œ í›„ swap

**10-3. ëŒ€í˜• ë°°í¬ ì¡**

```kotlin
val job = Ivm.client()
  .ingest()
  .product { ... }
  .deployAsync {
    compile.async()
    ship.async {
      opensearch()
      personalize()
    }
  }

Ivm.client().deploy.status(job.id)
```

**ë™ì‘**:
- Compile: ë¹„ë™ê¸° ìˆ˜í–‰ (outbox)
- Ship: ë¹„ë™ê¸° ìˆ˜í–‰ (outbox, ì—°ì‡„)
- Cutover: READY ë„ë‹¬ ì¦‰ì‹œ swap (ê¸°ë³¸ê°’)

**10-4. ì „ë¶€ ëë‚˜ì•¼ ë…¸ì¶œ**

```kotlin
Ivm.client()
  .ingest()
  .product { ... }
  .deployAsync {
    compile.async()
    cutover.done()
    ship.async {
      opensearch()
      personalize()
    }
  }
```

**ë™ì‘**:
- Compile: ë¹„ë™ê¸° ìˆ˜í–‰ (outbox)
- Ship: ë¹„ë™ê¸° ìˆ˜í–‰ (outbox)
- Cutover: Ship ì™„ë£Œ í›„ swap (cutover.done())

11. DX Shortcut API (ê¶Œì¥)

**11-1. deployNow { ... }**

**ì •ì˜**: compile sync + ship async

**ì‚¬ìš© ì‚¬ë¡€**: ì¼ë°˜ì ì¸ ë°°í¬

```kotlin
Ivm.client()
  .ingest()
  .product { ... }
  .deployNow {
    opensearch()
    personalize()
  }
```

**11-2. deployNowAndShipNow { ... }**

**ì •ì˜**: compile sync + ship sync

**ì‚¬ìš© ì‚¬ë¡€**: ì¦‰ì‹œ ë°˜ì˜ì´ í•„ìš”í•œ ê²½ìš°

```kotlin
Ivm.client()
  .ingest()
  .product { ... }
  .deployNowAndShipNow {
    opensearch()
    personalize()
  }
```

**11-3. deployQueued { ... }**

**ì •ì˜**: compile async + ship async

**ì‚¬ìš© ì‚¬ë¡€**: ëŒ€í˜• ë°°í¬ ì¡

```kotlin
val job = Ivm.client()
  .ingest()
  .product { ... }
  .deployQueued {
    opensearch()
    personalize()
  }
```

12. ê²°ì • ì‚¬í•­

**D1/D2 ë“± ì½”ë“œë„¤ì„ íê¸°**: Compile / Ship / Cutover 3ì¶•ìœ¼ë¡œë§Œ í‘œí˜„

**DeployëŠ” compile / ship / cutover 3ì¶•ìœ¼ë¡œë§Œ í‘œí˜„**: ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬

**ê¸°ë³¸ê°’ì€ compile.sync + ship.async + cutover.ready**: ê°€ì¥ ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€

**OutboxëŠ” ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ ì‚¬ìš©**: ì‹¤í–‰ ë¶„ë¦¬Â·í™•ì¥Â·ê´€ì¸¡ì„ ìœ„í•œ SSOT

**SDKëŠ” contract codegen Fluent DSLë¡œ ê³ ì •**: IDEê°€ ë¬¸ì„œê°€ ë˜ë„ë¡ ì„¤ê³„

**ë¶ˆê°€ëŠ¥í•œ ì¡°í•©ì€ SDK íƒ€ì… ë‹¨ê³„ì—ì„œ ì°¨ë‹¨**: compile.async + ship.sync ê¸ˆì§€

13. RFC-001~007ê³¼ì˜ ì¼ê´€ì„± ìš”ì•½

**13-1. í•µì‹¬ ê°œë… ì¼ì¹˜**

- Compile = RFC-001ì˜ slicing (RFC-001: 10-1)
- Ship = RFC-007ì˜ Sink Orchestration (RFC-007: 5-1)
- Cutover = RFC-001ì˜ active_version ì—…ë°ì´íŠ¸ (RFC-001: 19)
- Outbox = RFC-007ì˜ ë¹„ë™ê¸° íŠ¸ë¦¬ê±° (RFC-007: 3-2)

**13-2. ë¶ˆë³€ì‹ ì¤€ìˆ˜**

- ê²°ì •ì„± ë³´ì¥ (RFC-002: 1-3)
- ë©±ë“±ì„± ë³´ì¥ (RFC-002: 1-4)
- Fail-closed ì •ì±… (RFC-001: 1-5)
- OutboxëŠ” ë¹„ë™ê¸° ê²½ê³„ì—ì„œë§Œ ì‚¬ìš© (RFC-007: 7-1)

**13-3. ìš©ì–´ êµ¬ë¶„**

- Compile: ë‚´ë¶€ ê³„ì‚° ë‹¨ê³„ (RFC-001)
- Ship: ì™¸ë¶€ ì „íŒŒ ë‹¨ê³„ (RFC-007)
- Cutover: í¬ì¸í„° ì „í™˜ ë‹¨ê³„ (RFC-001)
- Outbox: ë¹„ë™ê¸° ì‹¤í–‰ ë¶„ë¦¬ (RFC-007)

14. í•œ ì¤„ ìš”ì•½

**Compileì€ ì–¸ì œ í• ì§€, Shipì€ ì–´ë””ì„œ í• ì§€, CutoverëŠ” ì–¸ì œ í• ì§€ë§Œ ê³ ë¥´ë©´ ëœë‹¤. ë‚˜ë¨¸ì§€ëŠ” IVMì´ ì•Œì•„ì„œ í•œë‹¤.**
